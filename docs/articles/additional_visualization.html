<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="variancePartition">
<title>Additional visualizations of variance structure â€¢ variancePartition</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Additional visualizations of variance structure">
<meta property="og:description" content="variancePartition">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">variancePartition</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.33.15</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/variancePartition.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dream.html">dream analysis</a>
    <a class="dropdown-item" href="../articles/rnd_effects.html">Theory and practice of random effects</a>
    <a class="dropdown-item" href="../articles/mvtests.html">Multivariate tests</a>
    <a class="dropdown-item" href="../articles/additional_visualization.html">Additional visualizations of variance structure</a>
    <a class="dropdown-item" href="../articles/errors.html">Error handling</a>
    <a class="dropdown-item" href="../articles/FAQ.html">Frequently asked questions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DiseaseNeuroGenomics/variancePartition/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Additional visualizations of variance structure</h1>
                        <h4 data-toc-skip class="author">Developed by <a href="http://gabrielhoffman.github.io/" class="external-link">Gabriel Hoffman</a>
</h4>
            
            <h4 data-toc-skip class="date">Run on 2024-05-31
16:11:08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DiseaseNeuroGenomics/variancePartition/blob/HEAD/vignettes/additional_visualization.Rmd" class="external-link"><code>vignettes/additional_visualization.Rmd</code></a></small>
      <div class="d-none name"><code>additional_visualization.Rmd</code></div>
    </div>

    
    
<p>The correlation structure between samples in complex study designs
can be decomposed into the contribution of multiple dimensions of
variation. <code>variancePartition</code> provides a statistical and
visualization framework to interpret sources of variation. Here I
describe a visualization of the correlation structure between samples
for a single gene.</p>
<p>In the example dataset described in the main vignette, samples are
correlated because they can come from the same individual or the same
tissue. The function <code><a href="../reference/plotCorrStructure.html">plotCorrStructure()</a></code> shows the
correlation structure caused by each variable as well and the joint
correlation structure. Figure 1 shows the correlation between samples
from the same individual where (a) shows the samples sorted based on
clustering of the correlation matrix and (b) shows the original order.
Figure 1 c) and d) shows the same type of plot except demonstrating the
effect of tissue. The total correlation structure from summing
individual and tissue correlation matricies is shown in Figure 2. The
code to generate these plots is shown below.</p>
<div class="section level2">
<h2 id="plot-variance-structure">Plot variance structure<a class="anchor" aria-label="anchor" href="#plot-variance-structure"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit linear mixed model and examine correlation stucture</span></span>
<span><span class="co"># for one gene</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">varPartData</span><span class="op">)</span></span>
<span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># focus on one gene</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">fitList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="section level3">
<h3 id="by-individual">By Individual<a class="anchor" aria-label="anchor" href="#by-individual"></a>
</h3>
<div class="section level4">
<h4 id="reorder-samples">Reorder samples<a class="anchor" aria-label="anchor" href="#reorder-samples"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1a</span></span>
<span><span class="co"># correlation structure based on similarity within Individual</span></span>
<span><span class="co"># reorder samples based on clustering</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Individual"</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructa-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="original-order-of-samples">Original order of samples<a class="anchor" aria-label="anchor" href="#original-order-of-samples"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1b</span></span>
<span><span class="co"># use original order of samples</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Individual"</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructb-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="by-tissue">By Tissue<a class="anchor" aria-label="anchor" href="#by-tissue"></a>
</h3>
<div class="section level4">
<h4 id="reorder-samples-1">Reorder samples<a class="anchor" aria-label="anchor" href="#reorder-samples-1"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1c</span></span>
<span><span class="co"># correlation structure based on similarity within Tissue</span></span>
<span><span class="co"># reorder samples based on clustering</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Tissue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructc-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="original-order-of-samples-1">Original order of samples<a class="anchor" aria-label="anchor" href="#original-order-of-samples-1"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1d</span></span>
<span><span class="co"># use original order of samples</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Tissue"</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructd-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="by-individual-and-tissue">By Individual and Tissue<a class="anchor" aria-label="anchor" href="#by-individual-and-tissue"></a>
</h3>
<div class="section level4">
<h4 id="reorder-samples-2">Reorder samples<a class="anchor" aria-label="anchor" href="#reorder-samples-2"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 2a</span></span>
<span><span class="co"># correlation structure based on similarity within</span></span>
<span><span class="co"># Individual *and* Tissue, reorder samples based on clustering</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructe-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="original-order-of-samples-2">Original order of samples<a class="anchor" aria-label="anchor" href="#original-order-of-samples-2"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 2b</span></span>
<span><span class="co"># use original order of samples</span></span>
<span><span class="fu"><a href="../reference/plotCorrStructure.html">plotCorrStructure</a></span><span class="op">(</span><span class="va">fit</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="additional_visualization_files/figure-html/corStructf-1.png" width="672"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<details><pre><code><span><span class="co">## R version 4.3.0 (2023-04-21)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin22.4.0 (64-bit)</span></span>
<span><span class="co">## Running under: macOS 14.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Users/gabrielhoffman/prog/R-4.3.0/lib/libRblas.dylib </span></span>
<span><span class="co">## LAPACK: /usr/local/Cellar/r/4.4.0_1/lib/R/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/New_York</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] variancePartition_1.33.15 BiocParallel_1.34.2      </span></span>
<span><span class="co">## [3] limma_3.56.2              ggplot2_3.4.4            </span></span>
<span><span class="co">## [5] knitr_1.43               </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tidyselect_1.2.0    dplyr_1.1.2         bitops_1.0-7       </span></span>
<span><span class="co">##  [4] fastmap_1.1.1       digest_0.6.33       lifecycle_1.0.3    </span></span>
<span><span class="co">##  [7] magrittr_2.0.3      compiler_4.3.0      rlang_1.1.1        </span></span>
<span><span class="co">## [10] sass_0.4.9          tools_4.3.0         utf8_1.2.3         </span></span>
<span><span class="co">## [13] yaml_2.3.7          htmlwidgets_1.6.2   plyr_1.8.8         </span></span>
<span><span class="co">## [16] KernSmooth_2.23-21  withr_2.5.0         purrr_1.0.2        </span></span>
<span><span class="co">## [19] numDeriv_2016.8-1.1 BiocGenerics_0.46.0 desc_1.4.2         </span></span>
<span><span class="co">## [22] grid_4.3.0          aod_1.3.2           fansi_1.0.4        </span></span>
<span><span class="co">## [25] caTools_1.18.2      colorspace_2.1-0    scales_1.2.1       </span></span>
<span><span class="co">## [28] gtools_3.9.4        iterators_1.0.14    MASS_7.3-60        </span></span>
<span><span class="co">## [31] cli_3.6.1           mvtnorm_1.2-2       rmarkdown_2.22     </span></span>
<span><span class="co">## [34] ragg_1.2.5          generics_0.1.3      reshape2_1.4.4     </span></span>
<span><span class="co">## [37] minqa_1.2.5         cachem_1.0.8        stringr_1.5.0      </span></span>
<span><span class="co">## [40] splines_4.3.0       parallel_4.3.0      matrixStats_1.0.0  </span></span>
<span><span class="co">## [43] vctrs_0.6.3         boot_1.3-28.1       Matrix_1.6-5       </span></span>
<span><span class="co">## [46] jsonlite_1.8.5      pbkrtest_0.5.2      systemfonts_1.0.4  </span></span>
<span><span class="co">## [49] jquerylib_0.1.4     tidyr_1.3.1         glue_1.6.2         </span></span>
<span><span class="co">## [52] pkgdown_2.0.9       nloptr_2.0.3        codetools_0.2-19   </span></span>
<span><span class="co">## [55] stringi_1.7.12      gtable_0.3.3        EnvStats_2.7.0     </span></span>
<span><span class="co">## [58] lme4_1.1-35.1       lmerTest_3.1-3      munsell_0.5.0      </span></span>
<span><span class="co">## [61] tibble_3.2.1        remaCor_0.0.18      pillar_1.9.0       </span></span>
<span><span class="co">## [64] htmltools_0.5.8.1   gplots_3.1.3        R6_2.5.1           </span></span>
<span><span class="co">## [67] textshaping_0.3.6   Rdpack_2.4          rprojroot_2.0.3    </span></span>
<span><span class="co">## [70] evaluate_0.21       lattice_0.21-8      Biobase_2.60.0     </span></span>
<span><span class="co">## [73] highr_0.10          rbibutils_2.2.13    backports_1.4.1    </span></span>
<span><span class="co">## [76] RhpcBLASctl_0.23-42 memoise_2.0.1       broom_1.0.5        </span></span>
<span><span class="co">## [79] fANCOVA_0.6-1       corpcor_1.6.10      bslib_0.7.0        </span></span>
<span><span class="co">## [82] Rcpp_1.0.11         nlme_3.1-162        xfun_0.39          </span></span>
<span><span class="co">## [85] fs_1.6.2            pkgconfig_2.0.3</span></span></code></pre>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://gabrielhoffman.github.io" class="external-link">Gabriel Hoffman</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
